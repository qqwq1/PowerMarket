name: CI
on:
  push: { branches: [ "backend", "dev", "main" ] }
  pull_request: { branches: [ "dev", "main" ] }

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }
      - uses: actions/setup-java@v4
        with: { distribution: temurin, java-version: "21" }
      - name: Download Gradle 8.9
        run: |
          curl -sL https://services.gradle.org/distributions/gradle-8.9-bin.zip -o gradle.zip
          unzip -q gradle.zip
      - name: Build and tests
        working-directory: app
        run: ../gradle-8.9/bin/gradle clean build jacocoTestReport
      # SonarCloud — временно выключен
      # - name: SonarCloud Scan
      #   if: ${{ false }}
      #   uses: SonarSource/sonarcloud-github-action@v2
      #   with: { projectBaseDir: app }
      #   env: { SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }} }
